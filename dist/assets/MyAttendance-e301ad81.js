import{r as c,A as C,j as e}from"./index-6b86054d.js";import{a as m}from"./attendanceService-f819a721.js";function b(){const l=c.useRef(null),x=c.useRef(null),f=c.useRef(null),{user:a}=c.useContext(C),[p,j]=c.useState(null),[t,k]=c.useState(null),[o,d]=c.useState(!1),u=c.useCallback(async()=>{try{const s=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:!1});f.current=s,l.current&&(l.current.srcObject=s,await l.current.play())}catch(s){console.warn("camera",s)}},[]),h=c.useCallback(()=>{try{const s=f.current;s&&s.getTracks().forEach(n=>n.stop()),l.current&&(l.current.srcObject=null)}catch{}},[]);c.useEffect(()=>(u(),()=>h()),[u,h]);const r=c.useCallback(()=>{const s=l.current;if(!s)return;const n=x.current;n.width=s.videoWidth||640,n.height=s.videoHeight||480,n.getContext("2d").drawImage(s,0,0,n.width,n.height);const g=n.toDataURL("image/png");return j(g),g},[]),i=c.useCallback(async()=>{if(!(a!=null&&a.employeeId))return;const s=await m.getTodayLog(a.employeeId);k(s.data)},[a]);c.useEffect(()=>{i()},[i]);const v=c.useCallback(async()=>{d(!0);try{const s=r();await m.clockIn({employeeId:a.employeeId,photoDataUrl:s}),await i(),alert("Clocked in")}catch(s){alert(s.message||"Failed")}finally{d(!1)}},[r,a,i]),y=c.useCallback(async()=>{d(!0);try{const s=r();await m.clockOut({employeeId:a.employeeId,photoDataUrl:s}),await i(),alert("Clocked out")}catch(s){alert(s.message||"Failed")}finally{d(!1)}},[r,a,i]);return e.jsxs("div",{style:{display:"flex",gap:12,flexWrap:"wrap"},children:[e.jsxs("div",{style:{flex:1,minWidth:280},children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{fontWeight:700},children:"Camera"}),e.jsxs("div",{style:{marginTop:8,background:"#000",height:280,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("video",{ref:l,style:{maxWidth:"100%",maxHeight:"100%"},playsInline:!0,muted:!0}),e.jsx("canvas",{ref:x,style:{display:"none"}})]}),e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>r(),children:"Capture"}),e.jsx("button",{className:"btn",onClick:()=>u(),children:"Start"}),e.jsx("button",{className:"btn",onClick:()=>h(),children:"Stop"})]})]}),p&&e.jsx("div",{className:"card",style:{marginTop:8},children:e.jsx("img",{src:p,alt:"preview",style:{width:"100%"}})})]}),e.jsx("div",{style:{width:320},children:e.jsxs("div",{className:"card",children:[e.jsx("div",{style:{fontWeight:700},children:"Today"}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{className:"text-muted",children:"Clock in"}),e.jsx("div",{children:t!=null&&t.clockIn?new Date(t.clockIn).toLocaleString():"-"})]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{className:"text-muted",children:"Clock out"}),e.jsx("div",{children:t!=null&&t.clockOut?new Date(t.clockOut).toLocaleString():"-"})]}),e.jsxs("div",{style:{marginTop:12},children:[!(t!=null&&t.clockIn)&&e.jsx("button",{className:"btn",onClick:v,disabled:o,children:o?"...":"Clock In"}),(t==null?void 0:t.clockIn)&&!(t!=null&&t.clockOut)&&e.jsx("button",{className:"btn",onClick:y,disabled:o,children:o?"...":"Clock Out"}),(t==null?void 0:t.clockIn)&&(t==null?void 0:t.clockOut)&&e.jsx("div",{className:"text-muted",children:"Attendance complete"})]})]})})]})}function T(){return e.jsxs("div",{children:[e.jsx("h1",{style:{color:"var(--green-dark)"},children:"My Attendance"}),e.jsx(b,{})]})}export{T as default};
